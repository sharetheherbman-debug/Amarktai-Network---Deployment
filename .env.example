# Amarktai Network - Environment Configuration
# Copy this file to .env and fill in your values
# DO NOT commit .env to version control
# ============================================================================
# Amarktai Network - Environment Configuration Template
# ============================================================================
# Copy this file to .env and fill in your actual values
# For production deployment, ensure all secrets are properly secured

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# MongoDB connection string
# Local: mongodb://localhost:27017
# Remote: mongodb://username:password@host:port
MONGO_URL=mongodb://localhost:27017

# Database name
DB_NAME=amarktai_trading

# ============================================================================
# FEATURE FLAGS (Plug-and-Play Deployment Safety)
# ============================================================================
# These flags control which subsystems are enabled on startup.
# For fresh installations, keep dangerous systems disabled (0) until configured.

# Enable trading engines (Paper Trading, Production Trading, Risk Management)
# Set to 1 only when ready for trading with configured API keys
ENABLE_TRADING=0

# Enable autopilot systems (Auto-reinvestment, bot spawning, capital allocation)
# Set to 1 only when trading is stable and you want autonomous operation
ENABLE_AUTOPILOT=0

# Enable CCXT exchange connections (Luno, Binance, KuCoin)
# Set to 1 when exchange API keys are configured
ENABLE_CCXT=0

# Enable schedulers (AI Backend, Learning, Self-Healing, Advanced Orders)
# Generally safe to enable (1) as these don't trade
ENABLE_SCHEDULERS=1

# ============================================================================
# SECURITY
# ============================================================================

# JWT secret for token signing (MUST be changed in production!)
# Generate with: openssl rand -hex 32
JWT_SECRET=your-secret-key-change-in-production-min-32-chars

# API Key Encryption Key (for encrypting exchange API keys in database)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# CRITICAL: Store securely (e.g., AWS Secrets Manager, HashiCorp Vault)
API_KEY_ENCRYPTION_KEY=

# ============================================================================
# AI SERVICES (SYSTEM DEFAULTS - Optional)
# ============================================================================
# 
# PER-USER API KEYS:
# Users can configure their own API keys through the Dashboard (ðŸ”‘ API Keys section).
# These system keys are optional fallbacks when users don't provide their own keys.
# 
# - If a user configures their own OpenAI/FLock/Fetch wallet, their key is used
# - If not configured, the system key below is used as fallback
# - Users' keys are encrypted and stored per-user in MongoDB
# 
# RECOMMENDED: Encourage users to provide their own keys for better privacy/control

# OpenAI API Key (optional system default for AI trading decisions)
# Get from: https://platform.openai.com/api-keys
# Users can provide their own key in Dashboard â†’ API Keys
OPENAI_API_KEY=

# ============================================================================
# EMAIL CONFIGURATION (Optional but recommended)
# ============================================================================

# SMTP Server
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587

# Email credentials
# For Gmail: Use app-specific password (https://myaccount.google.com/apppasswords)
SMTP_USER=
SMTP_PASSWORD=

# Email sender details
FROM_EMAIL=
FROM_NAME=Amarktai Network
SMTP_FROM_EMAIL=

# Daily Report Configuration
DAILY_REPORT_TIME=08:00  # Time to send daily reports (24-hour format, UTC)

# ============================================================================
# OPTIONAL INTEGRATIONS
# ============================================================================

# Fetch.ai API Key (for additional market intelligence)
FETCHAI_API_KEY=

# FLOKx API Key (for market analysis)
FLOKX_API_KEY=

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Enable real-time SSE events (default: true)
ENABLE_REALTIME=true

# Enable order pipeline with 4-gate guardrails (Phase 2) (default: true)
USE_ORDER_PIPELINE=true

# ============================================================================
# TRADING CONFIGURATION (Optional - defaults in config.py)
# ============================================================================

# Maximum trades per user per day across all bots (default: 3000)
# MAX_TRADES_PER_USER_PER_DAY=3000

# Paper trading training period in days before live promotion (default: 7)
PAPER_TRAINING_DAYS=7

# Minimum win rate for bot promotion to live (default: 0.52 = 52%)
MIN_WIN_RATE=0.52

# Minimum profit percentage for promotion (default: 0.03 = 3%)
MIN_PROFIT_PERCENT=0.03

# Minimum number of trades before promotion eligibility (default: 25)
MIN_TRADES_FOR_PROMOTION=25

# Safety factor for exchange trade limits (default: 0.80 = 80% of max)
# EXCHANGE_SAFETY_FACTOR=0.80

# ============================================================================
# AUTOPILOT SETTINGS (Optional)
# ============================================================================

# Reinvestment threshold in ZAR (default: 500)
# REINVEST_THRESHOLD_ZAR=500

# Capital allocated to new bots (default: 1000)
# NEW_BOT_CAPITAL=1000

# Maximum total bots system-wide (default: 30)
# MAX_TOTAL_BOTS=30

# Number of top performers to track (default: 5)
# TOP_PERFORMERS_COUNT=5

# ============================================================================
# RISK MANAGEMENT (Optional)
# ============================================================================

# Stop loss percentages per risk mode
# STOP_LOSS_SAFE=0.05      # 5%
# STOP_LOSS_BALANCED=0.10  # 10%
# STOP_LOSS_AGGRESSIVE=0.15 # 15%

# Maximum loss per hour before auto-pause (default: 0.15 = 15%)
# MAX_HOURLY_LOSS_PERCENT=0.15

# Maximum drawdown before alert (default: 0.20 = 20%)
# MAX_DRAWDOWN_PERCENT=0.20

# ============================================================================
# PHASE 2: ORDER PIPELINE & EXECUTION GUARDRAILS
# ============================================================================

# Trade Limits (per day unless specified)
MAX_TRADES_PER_BOT_DAILY=50
MAX_TRADES_PER_USER_DAILY=500
BURST_LIMIT_ORDERS_PER_EXCHANGE=10
BURST_LIMIT_WINDOW_SECONDS=10

# Circuit Breaker Thresholds
MAX_DRAWDOWN_PERCENT=0.20  # 20% drawdown trips circuit breaker
MAX_DAILY_LOSS_PERCENT=0.10  # 10% daily loss trips circuit breaker
MAX_CONSECUTIVE_LOSSES=5  # 5 losses in a row trips circuit breaker
MAX_ERRORS_PER_HOUR=10  # 10 errors/hour trips circuit breaker

# Fee Coverage Gate
MIN_EDGE_BPS=10  # Minimum 10 basis points edge required
SAFETY_MARGIN_BPS=5  # Additional 5 bps safety buffer
SLIPPAGE_BUFFER_BPS=10  # 10 bps slippage assumption for market orders

# Idempotency Configuration
PENDING_ORDER_TTL_HOURS=24  # Pending orders expire after 24 hours

# ============================================================================
# EXCHANGE BOT LIMITS (Optional)
# ============================================================================

# Maximum bots per exchange (defaults in config.py)
# EXCHANGE_BOT_LIMITS_LUNO=5
# EXCHANGE_BOT_LIMITS_BINANCE=10
# EXCHANGE_BOT_LIMITS_KUCOIN=10
# EXCHANGE_BOT_LIMITS_KRAKEN=10
# EXCHANGE_BOT_LIMITS_VALR=10

# ============================================================================
# LOGGING (Optional)
# ============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# LOG_LEVEL=INFO

# ============================================================================
# NOTES
# ============================================================================

# 1. Required fields:
#    - MONGO_URL
#    - DB_NAME
#    - JWT_SECRET (MUST change in production!)
#
# 2. Recommended fields:
#    - OPENAI_API_KEY (for AI features)
#    - SMTP credentials (for email alerts)
#
# 3. Optional fields have defaults in backend/config.py
#
# 4. Security best practices:
#    - Never commit .env to git
#    - Use strong JWT_SECRET (32+ characters)
#    - Use app-specific passwords for email
#    - Keep API keys secret and rotate regularly
#
# 5. Production checklist:
#    - [ ] Changed JWT_SECRET
#    - [ ] Configured MongoDB with authentication
#    - [ ] Set up SMTP for email alerts
#    - [ ] Added OpenAI API key
#    - [ ] Tested with smoke_test.sh
#    - [ ] Backed up .env file securely
# MongoDB connection URI
# Local: mongodb://localhost:27017
# Docker: mongodb://127.0.0.1:27017
# Remote: mongodb://username:password@host:port/database
MONGO_URI=mongodb://127.0.0.1:27017

# Database name
MONGO_DB_NAME=amarktai

# ============================================================================
# SECURITY & AUTHENTICATION
# ============================================================================
# JWT secret for token signing - MUST be changed in production!
# Generate with: openssl rand -hex 32
JWT_SECRET=change-me-use-openssl-rand-hex-32

# Admin password for dashboard access
# Generate with: openssl rand -base64 24
ADMIN_PASSWORD=change-me-secure-password

# ============================================================================
# AI & OPENAI CONFIGURATION
# ============================================================================
# OpenAI API key for AI features (chat, trading decisions, analysis)
# Get your key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=

# ============================================================================
# EMAIL CONFIGURATION (Optional)
# ============================================================================
# Enable/disable email alerts and reports
SMTP_ENABLED=false

# SMTP server configuration (if enabled)
SMTP_HOST=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
FROM_EMAIL=
FROM_NAME=Amarktai Network

# ============================================================================
# TRADING LIMITS & SAFETY
# ============================================================================
# Maximum number of trading bots per user
MAX_BOTS=10

# Maximum daily loss percentage before emergency stop (%)
MAX_DAILY_LOSS_PERCENT=5

# Minimum capital per bot (ZAR)
MIN_BOT_CAPITAL=1000

# ============================================================================
# SYSTEM FEATURES
# ============================================================================
# Enable real-time SSE (Server-Sent Events) streaming
ENABLE_REALTIME=true

# Enable paper trading mode by default
DEFAULT_PAPER_MODE=true

# Enable live trading (should be false until API keys are configured)
ENABLE_LIVE_TRADING=false

# ============================================================================
# EXTERNAL INTEGRATIONS (Optional)
# ============================================================================
# Fetch.ai API key for AI market signals
FETCHAI_API_KEY=

# FLOKx API key for market intelligence
FLOKX_API_KEY=

# ============================================================================
# PRODUCTION SETTINGS
# ============================================================================
# Server host and port (for direct run, systemd overrides this)
HOST=127.0.0.1
PORT=8000

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Environment: development, staging, production
ENVIRONMENT=production

# ============================================================================
# ADVANCED TRADING SYSTEM (Regime-Adaptive Intelligence)
# ============================================================================

# Regime Detection Configuration
REGIME_DETECTION_ENABLED=true
REGIME_LOOKBACK_PERIODS=100  # Historical periods for HMM/GMM training
REGIME_N_STATES=3  # Number of market regimes (Bullish/Calm, Bearish/Volatile, Squeeze)

# Order Flow Imbalance (OFI) Configuration
OFI_ENABLED=true
OFI_AGGREGATION_WINDOW=1  # Seconds to aggregate OFI signals
OFI_LOOKBACK_SECONDS=60  # History to maintain for OFI calculations
OFI_THRESHOLD=0.1  # Threshold for signal generation

# On-Chain Whale Monitoring
WHALE_MONITORING_ENABLED=true
WHALE_BTC_THRESHOLD_USD=100  # Minimum BTC transaction in USD
WHALE_ETH_THRESHOLD_COUNT=1000  # Minimum ETH transaction count
WHALE_LOOKBACK_HOURS=24  # Hours of whale activity history

# Sentiment Analysis
SENTIMENT_ANALYSIS_ENABLED=true
SENTIMENT_USE_AI=true  # Use OpenAI for sentiment (requires OPENAI_API_KEY)
SENTIMENT_NEWS_LIMIT=20  # Number of news articles to analyze

# Macro News Monitoring
MACRO_MONITORING_ENABLED=true
MACRO_LOOKBACK_DAYS=30  # Days of macro event history

# Alpha Fusion Weights (must sum to 1.0)
ALPHA_REGIME_WEIGHT=0.25  # Weight for regime detection signal
ALPHA_OFI_WEIGHT=0.20  # Weight for OFI signal
ALPHA_WHALE_WEIGHT=0.20  # Weight for whale activity signal
ALPHA_SENTIMENT_WEIGHT=0.20  # Weight for sentiment signal
ALPHA_MACRO_WEIGHT=0.15  # Weight for macro news signal

# Self-Healing AI Configuration
SELF_HEALING_ENABLED=true
SELF_HEALING_MAX_ERROR_RATE=10  # Max errors per window before escalation
SELF_HEALING_ERROR_WINDOW_MINUTES=60  # Error rate calculation window
SELF_HEALING_MAX_RETRIES=3  # Maximum retry attempts per error

# Infrastructure Enhancements
WEBSOCKET_ENABLED=true  # Real-time WebSocket data streams
GEOGRAPHIC_REGION=us-east-1  # AWS region for latency optimization (Tokyo: ap-northeast-1, Singapore: ap-southeast-1)

# Circuit Breaker ATR-based Thresholds
CIRCUIT_BREAKER_ATR_ENABLED=true
CIRCUIT_BREAKER_ATR_MULTIPLIER=3.0  # Suspend trading if unrealized P&L < 3 Ã— ATR

# ============================================================================
# MULTI-AGENT SYSTEM & ADVANCED FEATURES
# ============================================================================

# FLock.io API Integration (Trading Specialist)
FLOCK_API_KEY=  # FLock.io API key for flock-trading-specialist-v1 model
FLOCK_ENABLED=true  # Enable FLock.io vertical-specific trading intelligence

# Fractional Kelly Position Sizing
KELLY_FRACTION=0.25  # Use 25% of full Kelly for stability (0.1-0.5 recommended)
KELLY_MIN_POSITION_SIZE=0.01  # Minimum position as fraction of capital (1%)
KELLY_MAX_POSITION_SIZE=0.25  # Maximum position as fraction of capital (25%)

# Chandelier Exits (ATR-Based Stops)
CHANDELIER_ATR_PERIOD=14  # Period for ATR calculation
CHANDELIER_ATR_MULTIPLIER=3.0  # Multiplier for stop distance (2.0-4.0 recommended)
CHANDELIER_LOOKBACK_PERIOD=20  # Period for highest high/lowest low

# Prometheus Metrics & Observability
PROMETHEUS_ENABLED=true  # Export Prometheus metrics at /api/metrics
PROMETHEUS_PORT=9090  # Prometheus scrape port (if separate from main app)

# Reflexion Loop & Episodic Memory
REFLEXION_ENABLED=true  # Enable Responder-Critic-Revisor loop
REFLEXION_CHECK_INTERVAL=60  # Seconds between reflexion cycles
EPISODIC_MEMORY_ENABLED=true  # Enable LangChain Chroma episodic memory
CHROMA_DB_PATH=./chroma_db  # Path for Chroma vector database

# Fetch.ai uAgents Framework
UAGENTS_ENABLED=false  # Enable multi-agent system (experimental)
UAGENTS_BUREAU_PORT=8000  # Base port for agent bureau
FETCH_WALLET_SEED=  # Fetch wallet seed for Payment Protocol (keep secret!)
ALMANAC_ENABLED=false  # Register agents on Fetch.ai Almanac

# ============================================================================
# AUTONOMOUS PAYMENT AGENT (Fetch.ai Wallet Integration)
# ============================================================================

# Enable/disable Payment Agent
PAYMENT_AGENT_ENABLED=false  # Enable autonomous payment processing

# Fetch Wallet Configuration
# Generate mnemonic: python -c "from cosmpy.aerial.wallet import LocalWallet; print(LocalWallet.generate().mnemonic())"
# CRITICAL: Keep this secret and secure. Never commit to git.
FETCH_WALLET_SEED=  # 24-word mnemonic for Fetch wallet

# Network Configuration
FETCH_NETWORK=testnet  # testnet or mainnet

# Budget & Spending Limits
PAYMENT_DAILY_BUDGET_FET=100  # Maximum FET to spend per day
PAYMENT_MAX_SINGLE_FET=10  # Maximum FET for single payment
PAYMENT_MIN_BALANCE_FET=10  # Minimum wallet balance to maintain

# Payment Retry Configuration
PAYMENT_MAX_RETRIES=3  # Maximum retry attempts for failed payments
PAYMENT_RETRY_DELAY=10  # Seconds between retry attempts
PAYMENT_GAS_ESTIMATE_FET=0.01  # Estimated gas fee per transaction in FET

# Per-User Payment Configuration (Frontend)
# Each user can have their own wallet for autonomous payments
# Users configure these in their account settings
# USER_FETCH_WALLET_SEED (stored encrypted per user)
# USER_PAYMENT_DAILY_BUDGET_FET (per user limit)
# USER_PAYMENT_ENABLED (per user enable/disable)
